/* ============================================================================
   LOTTI WORKFLOW - JAVASCRIPT - MINIFIED
   Dipendenze: jQuery, Bootstrap 5
   ============================================================================ */
!function (o) { "use strict"; window.LottiWorkflow = window.LottiWorkflow || {}, LottiWorkflow.cambiaStato = function (t, i, e, n) { var a = LottiWorkflow.getStatoName(i); confirm(`Confermi il cambio stato a: ${a}?\n\nQuesta azione aggiornerà il workflow del lotto.`) && (LottiWorkflow.showLoader("Cambio stato in corso..."), o.ajax({ url: "/Lotti/CambiaStato", type: "POST", data: { id: t, nuovoStato: i, __RequestVerificationToken: o('input[name="__RequestVerificationToken"]').val() }, success: function (o) { LottiWorkflow.hideLoader(), o.success ? "function" == typeof e ? e(o) : LottiWorkflow.showSuccess("Stato cambiato con successo!", (function () { location.reload() })) : (LottiWorkflow.showError(o.message || "Errore nel cambio stato."), "function" == typeof n && n(o)) }, error: function (o, t, i) { LottiWorkflow.hideLoader(), LottiWorkflow.showError("Errore di connessione. Riprova più tardi."), "function" == typeof n && n({ message: i }) } })) }, LottiWorkflow.getStatoName = function (o) { return { 0: "Bozza", 1: "In Valutazione", 2: "Approvato", 3: "Rifiutato", 4: "In Elaborazione", 5: "Presentato", 6: "In Esame", 7: "Richiesta Integrazione", 8: "Vinto", 9: "Perso", 10: "Scartato", 11: "Annullato" }[o] || "Sconosciuto" }, LottiWorkflow.isStatoTerminale = function (o) { return [3, 8, 9, 10, 11].includes(parseInt(o)) }, LottiWorkflow.getStatoBadgeClass = function (o) { return { 0: "bg-secondary", 1: "bg-info", 2: "bg-success", 3: "bg-danger", 4: "bg-warning text-dark", 5: "bg-primary", 6: "bg-primary", 7: "bg-warning text-dark", 8: "bg-success", 9: "bg-danger", 10: "bg-dark", 11: "bg-secondary" }[o] || "bg-secondary" }, LottiWorkflow.animateTimeline = function (t, i) { var e = o(".workflow-timeline"); 0 !== e.length && e.find(".timeline-step").each((function (e) { var n = o(this), a = n.data("stato"); a >= t && a <= i && setTimeout((function () { n.addClass("animating"), setTimeout((function () { n.removeClass("animating") }), 600) }), 100 * e) })) }, LottiWorkflow.showLoader = function (t) { var i = o("#workflowLoader"); 0 === i.length && (i = o('<div id="workflowLoader" class="workflow-loader">').append('<div class="spinner-border text-primary" role="status">').append('<span class="ms-2 loader-text">Caricamento...</span>'), o("body").append(i)), i.find(".loader-text").text(t || "Caricamento..."), i.fadeIn(200) }, LottiWorkflow.hideLoader = function () { o("#workflowLoader").fadeOut(200) }, LottiWorkflow.showSuccess = function (t, i) { var e = o(`\n            <div class="alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3" \n                 style="z-index: 9999; min-width: 300px;" role="alert">\n                <i class="bi bi-check-circle"></i> ${t}\n                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n            </div>\n        `); o("body").append(e), setTimeout((function () { e.fadeOut(300, (function () { o(this).remove(), "function" == typeof i && i() })) }), 2e3) }, LottiWorkflow.showError = function (t) { var i = o(`\n            <div class="alert alert-danger alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3" \n                 style="z-index: 9999; min-width: 300px;" role="alert">\n                <i class="bi bi-exclamation-triangle"></i> ${t}\n                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n            </div>\n        `); o("body").append(i), setTimeout((function () { i.fadeOut(300, (function () { o(this).remove() })) }), 4e3) }, LottiWorkflow.confirmDelete = function (t, i) { confirm(`Sei sicuro di voler eliminare il lotto "${i}"?\n\nQuesta azione eliminerà anche:\n- Tutte le valutazioni associate\n- Tutte le elaborazioni\n- Tutti i partecipanti\n\nL'operazione NON può essere annullata.`) && (LottiWorkflow.showLoader("Eliminazione in corso..."), o.ajax({ url: "/Lotti/Delete", type: "POST", data: { id: t, __RequestVerificationToken: o('input[name="__RequestVerificationToken"]').val() }, success: function (o) { LottiWorkflow.hideLoader(), o.success ? LottiWorkflow.showSuccess("Lotto eliminato con successo!", (function () { window.location.href = o.redirectUrl })) : LottiWorkflow.showError(o.message || "Errore nell'eliminazione.") }, error: function () { LottiWorkflow.hideLoader(), LottiWorkflow.showError("Errore di connessione. Riprova.") } })) }, LottiWorkflow.initTooltips = function () { [].slice.call(document.querySelectorAll('.timeline-circle[data-bs-toggle="tooltip"]')).forEach((function (o) { new bootstrap.Tooltip(o) })) }, LottiWorkflow.initTimelineClickHandlers = function () { o(".timeline-step.clickable .timeline-circle").on("click", (function () { var t = o(this).closest(".timeline-step"), i = t.data("stato"), e = t.closest(".workflow-timeline").data("lotto-id"); e && void 0 !== i && LottiWorkflow.cambiaStato(e, i) })) }, o(document).ready((function () { LottiWorkflow.initTooltips(), o(".workflow-timeline").length > 0 && LottiWorkflow.initTimelineClickHandlers() })), window.cambiaStato = LottiWorkflow.cambiaStato, window.confirmDelete = LottiWorkflow.confirmDelete }(jQuery);
