@model Trasformazioni.Models.ViewModels.LottoDetailsViewModel

@if (!Model.HasElaborazione)
{
    <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        <strong>Nessuna elaborazione presente</strong>
        <p class="mb-0 mt-2">Il lotto non ha ancora un'elaborazione prezzi.</p>
    </div>
}
else
{
    <div class="card mb-3">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0">
                <i class="bi bi-calculator me-2"></i>
                Dettagli Elaborazione Prezzi
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <!-- Colonna Prezzi -->
                <div class="col-md-6">
                    <h6 class="text-primary mb-3">
                        <i class="bi bi-currency-euro me-2"></i>
                        Analisi Prezzi
                    </h6>

                    <dl class="row">
                        <dt class="col-sm-6">Prezzo Desiderato:</dt>
                        <dd class="col-sm-6">
                            @if (Model.PrezzoDesiderato.HasValue)
                            {
                                <strong class="text-success">@Model.PrezzoDesiderato.Value.ToString("C2")</strong>
                            }
                            else
                            {
                                <span class="text-muted">Non specificato</span>
                            }
                        </dd>

                        <dt class="col-sm-6">Prezzo Reale Uscita:</dt>
                        <dd class="col-sm-6">
                            @if (Model.PrezzoRealeUscita.HasValue)
                            {
                                <strong class="text-primary">@Model.PrezzoRealeUscita.Value.ToString("C2")</strong>
                            }
                            else
                            {
                                <span class="text-muted">Non specificato</span>
                            }
                        </dd>

                        @if (Model.PrezzoDesiderato.HasValue && Model.PrezzoRealeUscita.HasValue)
                        {
                            var differenza = Model.PrezzoRealeUscita.Value - Model.PrezzoDesiderato.Value;
                            var percentuale = Model.PrezzoDesiderato.Value != 0 
                                ? (differenza / Model.PrezzoDesiderato.Value * 100) 
                                : 0;

                            <dt class="col-sm-6">Differenza:</dt>
                            <dd class="col-sm-6">
                                @if (differenza > 0)
                                {
                                    <span class="badge bg-danger">
                                        <i class="bi bi-arrow-up me-1"></i>
                                        +@differenza.ToString("C2") (+@percentuale.ToString("F2")%)
                                    </span>
                                }
                                else if (differenza < 0)
                                {
                                    <span class="badge bg-success">
                                        <i class="bi bi-arrow-down me-1"></i>
                                        @differenza.ToString("C2") (@percentuale.ToString("F2")%)
                                    </span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">
                                        <i class="bi bi-dash me-1"></i>
                                        Nessuno scostamento
                                    </span>
                                }
                            </dd>

                            <dt class="col-sm-6">Valutazione:</dt>
                            <dd class="col-sm-6">
                                @if (Math.Abs(percentuale) <= 5)
                                {
                                    <span class="badge bg-success">Ottimale</span>
                                }
                                else if (Math.Abs(percentuale) <= 10)
                                {
                                    <span class="badge bg-warning text-dark">Accettabile</span>
                                }
                                else
                                {
                                    <span class="badge bg-danger">Critico</span>
                                }
                            </dd>
                        }

                        @if (Model.ImportoBaseAsta.HasValue)
                        {
                            <dt class="col-sm-6 mt-3 pt-3 border-top">Importo Base Asta:</dt>
                            <dd class="col-sm-6 mt-3 pt-3 border-top">
                                <span class="text-muted">@Model.ImportoBaseAsta.Value.ToString("C2")</span>
                            </dd>

                            @if (Model.PrezzoRealeUscita.HasValue)
                            {
                                var scostamentoAsta = ((Model.PrezzoRealeUscita.Value - Model.ImportoBaseAsta.Value) / Model.ImportoBaseAsta.Value * 100);
                                <dt class="col-sm-6">Scostamento da Base:</dt>
                                <dd class="col-sm-6">
                                    @if (scostamentoAsta > 0)
                                    {
                                        <span class="text-danger">+@scostamentoAsta.ToString("F2")%</span>
                                    }
                                    else if (scostamentoAsta < 0)
                                    {
                                        <span class="text-success">@scostamentoAsta.ToString("F2")%</span>
                                    }
                                    else
                                    {
                                        <span class="text-secondary">0%</span>
                                    }
                                </dd>
                            }
                        }
                    </dl>
                </div>

                <!-- Colonna Note e Info -->
                <div class="col-md-6">
                    <h6 class="text-primary mb-3">
                        <i class="bi bi-journal-text me-2"></i>
                        Informazioni Aggiuntive
                    </h6>

                    <dl class="row">
                        <dt class="col-sm-5">Data Elaborazione:</dt>
                        <dd class="col-sm-7">
                            @if (Model.DataElaborazione.HasValue)
                            {
                                @Model.DataElaborazione.Value.ToString("dd/MM/yyyy HH:mm")
                            }
                            else
                            {
                                <span class="text-muted">Non disponibile</span>
                            }
                        </dd>

                        <dt class="col-sm-5">Elaborato Da:</dt>
                        <dd class="col-sm-7">
                            @if (!string.IsNullOrEmpty(Model.ElaboratoDa))
                            {
                                @Model.ElaboratoDa
                            }
                            else
                            {
                                <span class="text-muted">Non specificato</span>
                            }
                        </dd>
                    </dl>

                    @if (!string.IsNullOrEmpty(Model.MotivazioneAdattamento))
                    {
                        <div class="mt-3">
                            <strong class="d-block mb-2">
                                <i class="bi bi-chat-left-quote me-2"></i>
                                Motivazione Adattamento:
                            </strong>
                            <div class="alert alert-warning mb-0">
                                @Model.MotivazioneAdattamento
                            </div>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(Model.NoteElaborazione))
                    {
                        <div class="mt-3">
                            <strong class="d-block mb-2">
                                <i class="bi bi-sticky me-2"></i>
                                Note:
                            </strong>
                            <div class="alert alert-info mb-0">
                                @Model.NoteElaborazione
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Grafico Comparativo (placeholder per future implementazioni) -->
    <div class="card bg-light">
        <div class="card-body text-center py-4">
            <i class="bi bi-bar-chart-line text-muted" style="font-size: 3rem;"></i>
            <p class="text-muted mb-0 mt-2">
                Visualizzazione grafica disponibile nelle prossime versioni
            </p>
        </div>
    </div>
}
